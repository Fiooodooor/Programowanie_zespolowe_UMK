<div class="row justify-content-center ">
    <style>
        #editEnvi_dragName {
            color: white;
            font: 1rem cookie, cursive;
            text-align: center;
            mix-blend-mode: difference;
        }
    </style>
    <div class="col-sm-6">
        <label>Nazwa Projektu</label>
        <input type="text" maxlength="100" class="form-control" id="editProject_nameProject" value="{{ project.project_name }}">
        <label>Opis Projektu</label>
        <textarea maxlength="1000" type="text" class="form-control" id="editProject_nameDesciption">{{ project.project_content }}</textarea>
        <label>Właściciel Projektu</label>
        <select class="form-control" id="owner_id">
            {% for user in users %}
                {% if user.id == project.owner.id %}
                    <option selected value="{{ user.id }}">{{ user.username }}</option>
                {% else %}
                    <option value="{{ user.id }}">{{ user.username }}</option>
                {% endif %}
            {% endfor %}
        </select>
         <label>Kategoria</label>
        <select class="form-control" id="category_id">
            <option value="1">Muzyka</option>
            <option value="2">Programowanie</option>
            <option value="3">Aplikacje Webowe</option>
        </select>
        <input type="file" name="file" id="fileBackground" style="display: none">
        <label>Obraz tła Projektu</label>
        <div class="col-lg-12 upload-area" id="uploadfile">
            <div id="backgroundEx" class="text-center "
                 style="background-size: 100% 100%;background-repeat: no-repeat;border-radius: 10px;padding: 4rem;;background-color: #f0f0f0;
                         {% if project.cover_image %}
                             background-image: url('{{ project.cover_image.url }}')"
                         {% endif %}
                 >
                <h3 id="editProject_dragName">Kliknij lub przeciągnij aby dodać tło </h3></div>
        </div>
            <input type="hidden" id="project_id" value="{{ project_id }}">
    </div>
</div>

<div class="row justify-content-center padding-bottom-2">
    <div class="col-sm-6 padding-top-1">
        <input type="button" value="{% if mode == 0 %}Edytuj{% else %}Dodaj Nowy {% endif %}" onclick="SendForm()" class="btn btn-outline-info">
    </div>
</div>
<script>
    selectedFile="";
    function SendForm() {
       $.post('/api/editprojectSave', {
            'cover_image': selectedFile,
            'owner': $('#owner_id').val(),
            'environment_id': WybraneSrodowisko,
            'project_name': $('#editProject_nameProject').val(),
            'project_description':$('#editProject_nameDesciption').val(),
            'project_category':$('#category_id').val(),
            'project_id': $('#project_id').val(),
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        }, function (result) {
            if (result != null) {
                if (result['project_name'] != "") {
                    trybPracy = 2;
                    ZmianaTrybuPracy();
                } else bootbox.alert("error");
            } else bootbox.alert("error");
        });

    }

    $(document).ready(function () {
        $("html").on("dragover", function (e) {
            e.preventDefault();
            e.stopPropagation();
            $("#editProject_dragName").text("Przeciągnij tu ");
        });

        $("html").on("drop", function (e) {
            e.preventDefault();
            e.stopPropagation();
        });
        $('.upload-area').on('dragenter', function (e) {
            e.stopPropagation();
            e.preventDefault();
            $("#editProject_dragName").text("Upuść tu ");
        });
        $('.upload-area').on('dragover', function (e) {
            e.stopPropagation();
            e.preventDefault();
            $("#editProject_dragName").text("Upuść tu ");
        });
        $('.upload-area').on('drop', function (e) {
            e.stopPropagation();
            e.preventDefault();
            $("#editProject_dragName").text("ładowanie pliku");
            $('#fileBackground')[0].files = e.originalEvent.dataTransfer.files;
            setImage();
            $("#editProject_dragName").text("Kliknij lub przeciągnij aby dodać tło");
        });

        $("#uploadfile").click(function () {
            $("#fileBackground").click();
        });

        $("#fileBackground").change(function () {
            setImage();
        });
    });

    function setImage() {
        file=$('#fileBackground')[0].files[0];
        if(file != null){
        if(checkSizeFile(file)) {
            if (checkFileTypes(file)) {
                getBase64(file).then(
                    data => {
                        selectedFile = data;
                        $('#backgroundEx').css('background-image', "url('" + data + "')")
                    }
                );
            } else bootbox.alert("Dozwolone są tylko obrazy ! ");
        }
         else bootbox.alert("Plik jest za duży.Max 30 MB");
        }
    }

    function checkFileTypes(file) {
        acceptmimetypes = ['image/apng', 'image/bmp', 'image/gif', 'image/jpeg', 'image/png'];
        for (var item of acceptmimetypes) if (item == file.type) return true;
        return false;
    }


</script>